<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Smart Study Companion ‚Äî Main</title>
<script src="https://cdn.jsdelivr.net/npm/particles.js"></script>
<style>
  :root{
    --bg-1:#031427; --bg-2:#061a38; --muted:#9fb4cf; --text:#dfeeff;
    --accent-1:#2fb4ff; --accent-2:#1b88ff; --danger:#ff6b6b;
    --radius:14px; --shadow:0 16px 36px rgba(2,6,23,0.6);
    font-family:'Poppins',system-ui,Arial,sans-serif;
  }
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;color:var(--text);background:transparent;overflow:hidden;padding:20px 28px 28px 28px;position:relative}
  #particles-js{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;background:
    radial-gradient(1000px 500px at 8% 8%, rgba(47,123,255,0.06), transparent 8%),
    linear-gradient(180deg,var(--bg-1),var(--bg-2))}
  .container{position:relative;z-index:2;max-width:1100px;margin:0 auto}
  .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
  .card{background:rgba(255,255,255,0.03);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);margin-bottom:18px}
  .btn{background:linear-gradient(90deg,var(--accent-1),var(--accent-2));border:none;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}
  .btn-secondary{background:linear-gradient(90deg,var(--accent-2),var(--accent-1));color:#fff}
  .input{width:100%;padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);color:var(--text);border:1px solid rgba(255,255,255,0.04)}
  .main-grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
  .task-list{list-style:none;padding:0;margin-top:10px}
  .task-item{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.04);padding:8px 12px;border-radius:8px;margin-bottom:6px}
  .progress-bar{height:10px;background:rgba(255,255,255,0.1);border-radius:999px;overflow:hidden}
  .progress-fill{height:100%;background:linear-gradient(90deg,#2dd4bf,#34d399);width:0%;transition:width .3s}
  .timer-circle{width:200px;height:200px;border-radius:50%;border:2px solid rgba(47,180,255,0.3);display:grid;place-items:center;margin:auto;box-shadow:0 0 30px rgba(47,180,255,0.25)}
  .timer-num{font-size:42px;font-weight:800;font-family:monospace;color:white;}
  .timer-adjust{display:flex;gap:10px;justify-content:center;margin-top:10px}
  .adjust-btn{width:36px;height:36px;border-radius:8px;border:none;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:#fff;font-size:18px;cursor:pointer}
  .chat-box{max-height:240px;overflow:auto;display:flex;flex-direction:column;gap:8px}
  .chat-bubble{padding:8px 10px;border-radius:8px;max-width:80%}
  .chat-user{background:#cfeefe;align-self:flex-end;color:#042233}
  .chat-bot{background:#eaf5ff;align-self:flex-start;color:#082135}
  .footer{text-align:center;color:var(--muted);margin-top:12px;font-size:13px}
</style>
</head>
<body>
  <div id="particles-js"></div>
  <div class="container">
    <header class="header">
      <div>
        <h1 style="margin:0">Smart Study Companion</h1>
        <div style="color:var(--muted);font-size:13px;margin-top:2px"></div>
      </div>
      <div style="display:flex;align-items:center;gap:10px">
        <div id="userBadge" class="card" style="padding:8px 12px;border-radius:999px">Guest</div>
        <button id="logoutBtn" class="btn" style="background:var(--danger)">Logout</button>
      </div>
    </header>

    <main class="main-grid">
      <!-- LEFT COLUMN -->
      <section>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <h3 style="margin:0">Tasks</h3>
              <div style="color:var(--muted);font-size:13px;margin-top:6px">Add study tasks and mark them complete</div>
            </div>
            <div style="color:var(--muted)">User: <strong id="currentUserLabel">Guest</strong></div>
          </div>

          <!-- Task input + deadline -->
          <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
            <input id="taskInput" class="input" placeholder="Add a study task...">
            <input id="taskDeadline" type="datetime-local" class="input" style="max-width:200px">
            <button id="addTaskBtn" type="button" class="btn">Add</button>
          </div>

          <ul id="taskList" class="task-list"></ul>
        </div>

        <!-- Pomodoro Timer -->
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <h3 style="margin:0">Pomodoro Timer</h3>
              <div style="color:var(--muted);font-size:13px;margin-top:6px">Work / Short Break / Long Break</div>
            </div>
            <div style="color:var(--muted)">Mode: <strong id="modeLabel">work</strong></div>
          </div>

          <div class="timer-circle" style="margin-top:12px"><div id="timerDisplay" class="timer-num">25:00</div></div>

          <div class="timer-adjust">
            <button id="decreaseBtn" class="adjust-btn">‚àí</button>
            <button id="increaseBtn" class="adjust-btn">+</button>
          </div>

          <div style="display:flex;gap:8px;justify-content:center;margin-top:12px;flex-wrap:wrap">
            <button id="startPauseBtn" class="btn">Start</button>
            <button id="resetBtn" class="btn">Reset</button>
            <button id="shortBreakBtn" class="btn btn-secondary">Short Break</button>
            <button id="longBreakBtn" class="btn btn-secondary">Long Break</button>
          </div>
        </div>
      </section>

      <!-- RIGHT SIDEBAR -->
      <aside>
        <div class="card">
          <h3 style="margin:0">Progress</h3>
          <div style="color:var(--muted);font-size:13px;margin-top:6px">Completed tasks</div>
          <div style="margin-top:8px">
            <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
            <div id="progressText" style="color:var(--muted);font-size:13px;margin-top:8px">0 / 0 (0%)</div>
          </div>
        </div>

        <div class="card">
          <h3 style="margin:0">AI Study Bot</h3>
          <div id="chatBox" class="chat-box"></div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="chatInput" class="input" placeholder="Ask the bot for a tip...">
            <button id="chatSendBtn" class="btn">Send</button>
          </div>
        </div>

        <div class="card" style="display:flex;flex-direction:column;gap:8px">
          <div style="color:var(--muted)">Utilities</div>
          <button id="clearTasksBtn" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)">Clear Tasks</button>
        </div>
      </aside>
    </main>

    <div class="footer">.</div>
  </div>

<script>
/* ===== LOGIN CHECK ===== */
const userEmail = localStorage.getItem('userEmail');
if(!userEmail){ window.location.href='login.html'; }
else{
  document.getElementById('currentUserLabel').textContent = userEmail;
  document.getElementById('userBadge').textContent = userEmail.split('@')[0];
}

const storageKey = `ssc_tasks_${userEmail}`;

/* ===== particles background ===== */
particlesJS('particles-js',{
  particles:{ number:{value:80}, size:{value:3}, move:{speed:2}, line_linked:{enable:true,color:'#00bfff'}, color:{value:'#00bfff'} },
  interactivity:{ events:{ onhover:{ enable:true, mode:'repulse'}}, modes:{ repulse:{ distance:100 } } }
});

/* ===== Tasks ===== */
const taskInput = document.getElementById('taskInput');
const taskDeadlineInput = document.getElementById('taskDeadline');
const addTaskBtn = document.getElementById('addTaskBtn');
const taskList = document.getElementById('taskList');
const progressFill = document.getElementById('progressFill');
const progressText = document.getElementById('progressText');

let tasks = JSON.parse(localStorage.getItem(storageKey) || '[]');

function escapeHtml(t){return t.replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"}[m]))}
function saveTasks(){ localStorage.setItem(storageKey, JSON.stringify(tasks)); }
function updateProgress(){
  const done = tasks.filter(t => t.done).length;
  const total = tasks.length;
  const pct = total ? Math.round(done/total*100) : 0;
  progressFill.style.width = pct+'%';
  progressText.textContent = `${done} / ${total} (${pct}%)`;
}

/* ===== Render Tasks ===== */
function renderTasks(){
  taskList.innerHTML='';
  if(tasks.length===0){
    taskList.innerHTML='<li style="color:var(--muted);padding:8px 0">No tasks ‚Äî add one above.</li>';
    updateProgress();
    return;
  }
  tasks.forEach((t,i)=>{
    const li=document.createElement('li');
    li.className='task-item';
    let deadlineText='', overdue=false;
    if(t.deadline){
      const now=Date.now();
      if(now>t.deadline && !t.done) overdue=true;
      const d=new Date(t.deadline);
      deadlineText=` ‚Äî Due: ${d.toLocaleString()}${overdue?' ‚ö†Ô∏è Overdue':''}`;
    }
    li.innerHTML=`<span style="text-decoration:${t.done?'line-through':'none'}; color:${overdue?'#ff6b6b':'inherit'}">
      ${escapeHtml(t.text)}${deadlineText}</span>
      <div style="display:flex;gap:6px">
        <button class="btn" style="padding:6px 8px;font-size:13px" onclick="toggleTask(${i})">${t.done?'Undo':'Done'}</button>
        <button class="btn" style="padding:6px 8px;font-size:13px" onclick="editTask(${i})">Edit</button>
        <button class="btn" style="padding:6px 8px;font-size:13px;background:var(--danger)" onclick="deleteTask(${i})">Del</button>
      </div>`;
    taskList.appendChild(li);
  });
  updateProgress();
  saveTasks();
}

window.toggleTask = i => { tasks[i].done=!tasks[i].done; renderTasks(); };
window.deleteTask = i => { tasks.splice(i,1); saveTasks(); renderTasks(); };

function addTask(){
  const v = taskInput.value.trim();
  if(!v) return;
  const deadline = taskDeadlineInput.value ? new Date(taskDeadlineInput.value).getTime() : null;
  tasks.unshift({text:v, done:false, created:Date.now(), deadline:deadline});
  taskInput.value=''; taskDeadlineInput.value='';
  renderTasks();
}

addTaskBtn.addEventListener('click', addTask);
taskInput.addEventListener('keypress', e=>{if(e.key==='Enter'){e.preventDefault();addTask();}});

/* ===== Edit Task ===== */
window.editTask = i => {
  const li = taskList.children[i]; const t = tasks[i];
  li.innerHTML=`
    <input type="text" id="editText${i}" class="input" value="${escapeHtml(t.text)}">
    <input type="datetime-local" id="editDeadline${i}" class="input" value="${t.deadline?new Date(t.deadline).toISOString().slice(0,16):''}">
    <div style="display:flex;gap:6px;margin-top:4px">
      <button class="btn" onclick="saveTask(${i})">Save</button>
      <button class="btn btn-secondary" onclick="renderTasks()">Cancel</button>
    </div>`;
};
window.saveTask = i => {
  const newText = document.getElementById(`editText${i}`).value.trim();
  const newDeadlineVal = document.getElementById(`editDeadline${i}`).value;
  if(!newText) return alert('Task text cannot be empty');
  tasks[i].text=newText;
  tasks[i].deadline=newDeadlineVal ? new Date(newDeadlineVal).getTime() : null;
  renderTasks();
};

/* ===== Clear Tasks ===== */
document.getElementById('clearTasksBtn').onclick = ()=>{
  if(!confirm('Clear all tasks?')) return;
  tasks=[]; saveTasks(); renderTasks();
};

/* ===== Chat Bot ===== */
const chatBox = document.getElementById('chatBox');
const chatInput = document.getElementById('chatInput');
const chatSendBtn = document.getElementById('chatSendBtn');
function addMessage(text,sender){
  const d = document.createElement('div');
  d.className='chat-bubble '+(sender==='user'?'chat-user':'chat-bot');
  d.textContent=text;
  chatBox.appendChild(d);
  chatBox.scrollTo({top:chatBox.scrollHeight, behavior:'smooth'});
}
chatSendBtn.onclick = ()=>{
  const msg = chatInput.value.trim(); if(!msg) return;
  addMessage(msg,'user'); chatInput.value='';
  setTimeout(()=>{
    const replies=["Keep it up! üí™","Try breaking your session into smaller tasks.","Remember to take short breaks!","Focus on one topic at a time.","Good job staying consistent!"];
    addMessage(replies[Math.floor(Math.random()*replies.length)],'bot');
  },700);
};

/* ===== Timer & Alarm ===== */
let timer=null, timeLeft=25*60, running=false, currentMode='work';
const display=document.getElementById('timerDisplay');
const startPauseBtn=document.getElementById('startPauseBtn');
const resetBtn=document.getElementById('resetBtn');
const shortBreakBtn=document.getElementById('shortBreakBtn');
const longBreakBtn=document.getElementById('longBreakBtn');
const increaseBtn=document.getElementById('increaseBtn');
const decreaseBtn=document.getElementById('decreaseBtn');
const modeLabel=document.getElementById('modeLabel');

function updateTimerDisplay(){
  const m=Math.floor(timeLeft/60).toString().padStart(2,'0');
  const s=(timeLeft%60).toString().padStart(2,'0');
  display.textContent=`${m}:${s}`;
  display.style.color=(timeLeft<=60)?'red':'white';
}

function setMode(mode){ currentMode=mode; modeLabel.textContent=mode; }

function playAlarmAudio(){
  if(window.alarmAudio){ 
    alarmAudio.currentTime=0; alarmAudio.play().catch(()=>{}); 
  }
}

function handleTimeUp(){
  clearInterval(timer); timer=null; running=false; startPauseBtn.textContent='Start';
  playAlarmAudio(); alert('‚è∞ Time is up!');
}

function startPause(){
  if(running){ clearInterval(timer); timer=null; running=false; startPauseBtn.textContent='Start'; }
  else{
    running=true; startPauseBtn.textContent='Pause';
    timer=setInterval(()=>{
      if(timeLeft>0){ timeLeft--; updateTimerDisplay(); } 
      else handleTimeUp();
    },1000);
  }
}

function resetTimer(){ clearInterval(timer); timer=null; running=false; timeLeft=25*60; setMode('work'); updateTimerDisplay(); startPauseBtn.textContent='Start'; }
function shortBreak(){ clearInterval(timer); timer=null; running=false; timeLeft=5*60; setMode('short'); updateTimerDisplay(); startPauseBtn.textContent='Start'; }
function longBreak(){ clearInterval(timer); timer=null; running=false; timeLeft=10*60; setMode('long'); updateTimerDisplay(); startPauseBtn.textContent='Start'; }
function increaseTime(){ timeLeft+=60; updateTimerDisplay(); }
function decreaseTime(){ if(timeLeft>60){ timeLeft-=60; updateTimerDisplay(); } }

startPauseBtn.onclick=startPause;
resetBtn.onclick=resetTimer;
shortBreakBtn.onclick=shortBreak;
longBreakBtn.onclick=longBreak;
increaseBtn.onclick=increaseTime;
decreaseBtn.onclick=decreaseTime;

updateTimerDisplay();
const alarmAudio = new Audio('https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg');

/* ===== Logout ===== */
document.getElementById('logoutBtn').onclick=()=>{
  localStorage.removeItem('userEmail'); window.location.href='login.html';
};

renderTasks();
</script>
</body>
</html>
